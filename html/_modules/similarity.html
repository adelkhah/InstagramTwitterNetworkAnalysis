<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>similarity &mdash; Social Media Analysis Twitter and Instagram 1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=404a92a0"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Social Media Analysis Twitter and Instagram
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">condainstagramanalys</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Social Media Analysis Twitter and Instagram</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">similarity</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for similarity</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">imgbeddings</span> <span class="kn">import</span> <span class="n">imgbeddings</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">dot</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">instagramscraper</span> <span class="k">as</span> <span class="nn">isp</span>
<span class="kn">import</span> <span class="nn">twitterscrape</span> <span class="k">as</span> <span class="nn">ts</span>
<span class="kn">from</span> <span class="nn">sent2vec.vectorizer</span> <span class="kn">import</span> <span class="n">Vectorizer</span>
<span class="kn">from</span> <span class="nn">hazm</span> <span class="kn">import</span> <span class="n">SentEmbedding</span>
<span class="kn">from</span> <span class="nn">langdetect</span> <span class="kn">import</span> <span class="n">detect</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="c1"># # Farsi text AI model</span>
<span class="c1"># sentEmbedding = SentEmbedding()</span>
<span class="c1"># sentEmbedding.load_model(&#39;sent2vec\sent2vec-naab.model&#39;)</span>
<span class="c1">#</span>
<span class="c1"># # english text AI model</span>
<span class="c1"># vectorizer = Vectorizer()</span>
<span class="c1">#</span>
<span class="c1"># # image AI modle</span>
<span class="c1"># ibed = imgbeddings()</span>
<span class="c1">#</span>

<div class="viewcode-block" id="cos_similarity"><a class="viewcode-back" href="../similarity.html#similarity.cos_similarity">[docs]</a><span class="k">def</span> <span class="nf">cos_similarity</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the cosine similarity between two vectors.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    a (np.array): The first vector.</span>
<span class="sd">    b (np.array): The second vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: The cosine similarity between the two vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="p">(</span><span class="n">bb</span><span class="p">))</span></div>


<div class="viewcode-block" id="count_jpg_files"><a class="viewcode-back" href="../similarity.html#similarity.count_jpg_files">[docs]</a><span class="k">def</span> <span class="nf">count_jpg_files</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function counts the number of .jpg files in a specific directory.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    name (str): The name of the directory to search in.</span>

<span class="sd">    Returns:</span>
<span class="sd">    int: The number of .jpg files in the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instagramuser/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">/images&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span></div>




<div class="viewcode-block" id="image_similarity_two_user"><a class="viewcode-back" href="../similarity.html#similarity.image_similarity_two_user">[docs]</a><span class="k">def</span> <span class="nf">image_similarity_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the average image similarity between two users&#39; images.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    u1 (str): The username of the first user.</span>
<span class="sd">    u2 (str): The username of the second user.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: The average image similarity between the two users&#39; images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u1image</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u2image</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u1n</span> <span class="o">=</span> <span class="n">count_jpg_files</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
    <span class="n">u2n</span> <span class="o">=</span> <span class="n">count_jpg_files</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">u1n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">u2n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instagramuser/</span><span class="si">{</span><span class="n">u1</span><span class="si">}</span><span class="s1">/images&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">u1n</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;/image-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.jpg&#39;</span>
        <span class="n">u1image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;instagramuser/</span><span class="si">{</span><span class="n">u2</span><span class="si">}</span><span class="s1">/images&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">u2n</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;/image-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.jpg&#39;</span>
        <span class="n">u2image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>


    <span class="n">u1bed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u2bed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">u1n</span><span class="p">):</span>
        <span class="n">u1bed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ibed</span><span class="o">.</span><span class="n">to_embeddings</span><span class="p">(</span><span class="n">u1image</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">u2n</span><span class="p">):</span>
        <span class="n">u2bed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ibed</span><span class="o">.</span><span class="n">to_embeddings</span><span class="p">(</span><span class="n">u2image</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">u1n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">u2n</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">cos_similarity</span><span class="p">(</span><span class="n">u1bed</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u2bed</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">u1n</span> <span class="o">*</span> <span class="n">u2n</span>
    <span class="k">return</span> <span class="nb">sum</span> <span class="o">/</span> <span class="n">count</span></div>



<div class="viewcode-block" id="common_instaneighbor_two_user"><a class="viewcode-back" href="../similarity.html#similarity.common_instaneighbor_two_user">[docs]</a><span class="k">def</span> <span class="nf">common_instaneighbor_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function finds the common Instagram followers between two users.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    u1 (str): The username of the first user.</span>
<span class="sd">    u2 (str): The username of the second user.</span>

<span class="sd">    Returns:</span>
<span class="sd">    int: The number of common followers between the two users.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u1f</span> <span class="o">=</span> <span class="n">isp</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
    <span class="n">u2f</span> <span class="o">=</span> <span class="n">isp</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u1f</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u2f</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="common_twitterneighbor_two_user"><a class="viewcode-back" href="../similarity.html#similarity.common_twitterneighbor_two_user">[docs]</a><span class="k">def</span> <span class="nf">common_twitterneighbor_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function finds the common Twitter followers between two users.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    u1 (str): The username of the first user.</span>
<span class="sd">    u2 (str): The username of the second user.</span>

<span class="sd">    Returns:</span>
<span class="sd">    int: The number of common followers between the two users.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u1f</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
    <span class="n">u2f</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u1f</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u2f</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>




<div class="viewcode-block" id="english_text_similarity"><a class="viewcode-back" href="../similarity.html#similarity.english_text_similarity">[docs]</a><span class="k">def</span> <span class="nf">english_text_similarity</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the text similarity between two English texts.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    text1 (str): The first text.</span>
<span class="sd">    text2 (str): The second text.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: The text similarity between the two texts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">]</span>
    <span class="n">vectorizer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
    <span class="n">vectors</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">vectors</span>
    <span class="k">return</span> <span class="n">cos_similarity</span><span class="p">(</span><span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="text_similarity"><a class="viewcode-back" href="../similarity.html#similarity.text_similarity">[docs]</a><span class="k">def</span> <span class="nf">text_similarity</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the text similarity between two texts.</span>
<span class="sd">    It supports both English and Farsi texts.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    text1 (str): The first text.</span>
<span class="sd">    text2 (str): The second text.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: The text similarity between the two texts. If the languages of the texts do not match or are not supported, it returns -10.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">det1</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">det2</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">det1</span> <span class="o">=</span> <span class="n">detect</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
        <span class="n">det2</span> <span class="o">=</span> <span class="n">detect</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">det1</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> <span class="ow">and</span> <span class="n">det2</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">english_text_similarity</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">det1</span> <span class="o">==</span> <span class="s1">&#39;fa&#39;</span> <span class="ow">and</span> <span class="n">det2</span> <span class="o">==</span> <span class="s1">&#39;fa&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sentEmbedding</span><span class="o">.</span><span class="n">similarity</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">10</span></div>


<div class="viewcode-block" id="tweet_similarity"><a class="viewcode-back" href="../similarity.html#similarity.tweet_similarity">[docs]</a><span class="k">def</span> <span class="nf">tweet_similarity</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the average text similarity between the tweets of two users.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    u1 (str): The username of the first user.</span>
<span class="sd">    u2 (str): The username of the second user.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: The average text similarity between the tweets of the two users. If the languages of the tweets do not match or are not supported, it ignores those pairs of tweets in the calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u1t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u2t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u1t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_comments</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u2t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_comments</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">u1t</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">u2t</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">text_similarity</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="n">res</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">/</span> <span class="n">count</span>
    <span class="k">return</span> <span class="n">ans</span></div>


<div class="viewcode-block" id="read_comments"><a class="viewcode-back" href="../similarity.html#similarity.read_comments">[docs]</a><span class="k">def</span> <span class="nf">read_comments</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># empty list to read list from a file</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># open file and read the content in a list</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;instagramuser/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">/comments.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
            <span class="c1"># remove linebreak from a current name</span>
            <span class="c1"># linebreak is the last character of each line</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># add current item to the list</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">names</span></div>


<div class="viewcode-block" id="post_similarity"><a class="viewcode-back" href="../similarity.html#similarity.post_similarity">[docs]</a><span class="k">def</span> <span class="nf">post_similarity</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the average text similarity between the posts of two users.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    u1 (str): The username of the first user.</span>
<span class="sd">    u2 (str): The username of the second user.</span>

<span class="sd">    Returns:</span>
<span class="sd">    float: The average text similarity between the posts of the two users. If the languages of the posts do not match or are not supported, it ignores those pairs of posts in the calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u1t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">u2t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u1t</span> <span class="o">=</span> <span class="n">read_comments</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u2t</span> <span class="o">=</span> <span class="n">read_comments</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">u1t</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">u2t</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">text_similarity</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="n">res</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">/</span> <span class="n">count</span>
    <span class="k">return</span> <span class="n">ans</span></div>


<div class="viewcode-block" id="find_most_similar_instagram_users"><a class="viewcode-back" href="../similarity.html#similarity.find_most_similar_instagram_users">[docs]</a><span class="k">def</span> <span class="nf">find_most_similar_instagram_users</span><span class="p">(</span><span class="n">numberOfuser</span><span class="p">,</span> <span class="n">minimumNeighbor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function finds the most similar Instagram users based on their followers.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    numberOfuser (int): The number of users to find.</span>
<span class="sd">    minimumNeighbor (int): The minimum number of common followers between two users to consider them similar.</span>

<span class="sd">    Returns:</span>
<span class="sd">    None: The function writes the results to a JSON file and does not return anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alluser</span> <span class="o">=</span> <span class="n">isp</span><span class="o">.</span><span class="n">read_alluser_fromFile</span><span class="p">()</span>
    <span class="n">linkpredict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dick</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alluser</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

            <span class="n">u1</span> <span class="o">=</span> <span class="n">alluser</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">alluser</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">u1fol</span> <span class="o">=</span> <span class="n">isp</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
            <span class="n">u2fol</span> <span class="o">=</span> <span class="n">isp</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">u1</span> <span class="ow">in</span> <span class="n">u2fol</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">u2</span> <span class="ow">in</span> <span class="n">u1fol</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">neighbor</span> <span class="o">=</span> <span class="n">common_instaneighbor_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">neighbor</span> <span class="o">&lt;</span> <span class="n">minimumNeighbor</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">tsim</span> <span class="o">=</span> <span class="n">image_similarity_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>

            <span class="n">linkpredict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">,</span> <span class="n">tsim</span><span class="p">))</span>

    <span class="n">baba</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">linkpredict</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dick</span><span class="p">[</span><span class="s1">&#39;similarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baba</span><span class="p">[:</span><span class="n">numberOfuser</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;trendtags/instagram_similarity_</span><span class="si">{</span><span class="n">numberOfuser</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dick</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_most_similar_twitter_users"><a class="viewcode-back" href="../similarity.html#similarity.find_most_similar_twitter_users">[docs]</a><span class="k">def</span> <span class="nf">find_most_similar_twitter_users</span><span class="p">(</span><span class="n">numberOfuser</span><span class="p">,</span> <span class="n">minimumNeighbor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function finds the most similar Twitter users based on their followers.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    numberOfuser (int): The number of users to find.</span>
<span class="sd">    minimumNeighbor (int): The minimum number of common followers between two users to consider them similar.</span>

<span class="sd">    Returns:</span>
<span class="sd">    None: The function writes the results to a JSON file and does not return anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alluser</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_alluser_fromFile</span><span class="p">()</span>
    <span class="n">linkpredict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dick</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alluser</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

            <span class="n">u1</span> <span class="o">=</span> <span class="n">alluser</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">alluser</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">u1fol</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
            <span class="n">u2fol</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">read_follower_fromFile</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">u1</span> <span class="ow">in</span> <span class="n">u2fol</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">u2</span> <span class="ow">in</span> <span class="n">u1fol</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">neighbor</span> <span class="o">=</span> <span class="n">common_instaneighbor_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">neighbor</span> <span class="o">&lt;</span> <span class="n">minimumNeighbor</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">tsim</span> <span class="o">=</span> <span class="n">image_similarity_two_user</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>

            <span class="n">linkpredict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">neighbor</span><span class="p">,</span> <span class="n">tsim</span><span class="p">))</span>

    <span class="n">baba</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">linkpredict</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dick</span><span class="p">[</span><span class="s1">&#39;similarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baba</span><span class="p">[:</span><span class="n">numberOfuser</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;trendtags/twitter_similarity_</span><span class="si">{</span><span class="n">numberOfuser</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dick</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">find_most_similar_instagram_users</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">find_most_similar_twitter_users</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Ali Adelkhah.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>